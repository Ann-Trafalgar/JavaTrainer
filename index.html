<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Java Code Trainer</title>
    <style>
        /* --- 1. Modern & Simplistic "Soft Dark" Design --- */
        :root {
            --bg-color: #121212;
            --container-color: #1e1e1e;
            --primary-color: #3ea6ff;
            --accent-color: #69f0ae; /* Green for "correct" */
            --error-color: #ff5252;
            --error-bg: #4d1a1a;
            --text-color: #e0e0e0;
            --text-muted: #757575;
            --border-color: #333333;
            --font-main: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            --font-code: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, Courier, monospace;
        }

        body {
            font-family: var(--font-main);
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            display: grid;
            place-items: center;
            min-height: 100vh;
            box-sizing: border-box;
        }

        .app-container {
            width: 90%;
            max-width: 1200px;
            background-color: var(--container-color);
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            padding: 30px;
            border: 1px solid var(--border-color);
        }

        h1 {
            color: var(--text-color);
            text-align: center;
            margin-top: 0;
            font-weight: 600;
        }
        
        h2 {
            color: var(--text-color);
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 10px;
            font-weight: 500;
            margin-bottom: 25px;
        }

        button {
            font-family: var(--font-main);
            font-size: 16px;
            font-weight: 500;
            border-radius: 8px;
            cursor: pointer;
            padding: 12px 20px;
            border: 1px solid var(--border-color);
            background-color: #2a2a2a;
            color: var(--text-color);
            transition: all 0.2s ease;
            margin: 5px;
        }

        button:hover {
            border-color: var(--primary-color);
            color: var(--primary-color);
            transform: translateY(-2px);
        }

        button.primary-btn {
            background-color: var(--primary-color);
            color: #000;
            border-color: var(--primary-color);
            font-weight: 600;
        }

        button.primary-btn:hover {
            background-color: #66bfff;
            color: #000;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(62, 166, 255, 0.1);
        }
        
        button.back-btn {
            background: none;
            border: none;
            color: var(--primary-color);
            padding: 0 5px;
            font-size: 16px;
            font-weight: 500;
            margin-bottom: 15px;
        }
        
        button.back-btn:hover {
            background: none;
            box-shadow: none;
            transform: none;
            text-decoration: underline;
        }

        /* --- 2. Part & Mode Selection --- */
        #part-selection {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 15px;
            padding: 20px 0;
        }

        #part-selection button {
            flex-basis: 200px;
            font-size: 18px;
            padding: 20px;
        }
        
        #mode-selection {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
        }

        /* --- 3. Workspace (Typing Area) --- */
        #workspace {
            display: none;
        }

        .typing-area-container {
            position: relative;
            width: 100%;
            height: 500px;
            margin: 20px 0;
            display: none;
        }

        #code-hint, #user-code-input {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 15px;
            box-sizing: border-box; 
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-family: var(--font-code);
            font-size: 14px;
            line-height: 1.5;
            white-space: pre;
            overflow: auto; /* Both scroll */
        }

        #code-hint {
            color: #555;
            background-color: var(--container-color);
            z-index: 1;
        }

        #user-code-input {
            color: var(--text-color);
            background: transparent;
            z-index: 2;
            resize: none;
            spellcheck: false;
            autocorrect: off;
            autocapitalize: off;
        }

        #user-code-input:focus {
            outline: none; 
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(62, 166, 255, 0.2);
        }

        /* --- 4. Results & Feedback Area --- */
        #results-area {
            margin-top: 20px;
            padding: 20px;
            border-radius: 8px;
            display: none;
            text-align: center;
            font-size: 1.3em;
            font-weight: 600;
        }

        #results-area.success {
            background-color: #1e4620;
            color: var(--accent-color);
            border: 1px solid var(--accent-color);
        }

        #results-area.error {
            background-color: var(--error-bg);
            color: var(--error-color);
            border: 1px solid var(--error-color);
        }
        
        #diff-container {
            display: none; 
            flex-direction: row;
            justify-content: space-between;
            gap: 20px;
            margin-top: 20px;
            text-align: left;
        }
        
        .diff-box {
            flex: 1;
            background-color: #2a2a2a;
            border-radius: 8px;
            padding: 15px;
            border: 1px solid var(--border-color);
        }
        
        .diff-box h3 {
            margin-top: 0;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 5px;
            font-weight: 500;
        }
        
        /* --- NEW: Colored Headers --- */
        .diff-box h3.user-header {
            color: var(--primary-color);
        }
        
        .diff-box h3.correct-header {
            color: var(--accent-color);
        }
        
        .diff-content {
            font-family: var(--font-code);
            font-size: 12px;
            line-height: 1.5;
            color: var(--text-muted);
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        
        /* --- NEW: Error only highlights the line with the class --- */
        .diff-content .diff-error {
            background-color: var(--error-bg);
            color: var(--error-color);
            display: block;
            min-height: 1.5em;
        }
        
        .diff-content .diff-correct {
            display: block;
            min-height: 1.5em;
        }

    </style>
</head>
<body>

    <div class="app-container">
        <h1>Java Code Trainer</h1>

        <div id="part-selection">
            <button onclick="showWorkspace(1)">Part 1: Players</button>
            <button onclick="showWorkspace(2)">Part 2: Board</button>
            <button onclick="showWorkspace(3)">Part 3: Logger</button>
            <button onclick="showWorkspace(4)">Part 4: Main Game</button>
        </div>

        <div id="workspace">
            <button class="back-btn" onclick="showMenu()">‚Üê Back to Menu</button>
            <h2 id="workspace-title"></h2>

            <div id="mode-selection">
                <button onclick="setMode('try')">Try Mode (With Hint)</button>
                <button onclick="setMode('invisible')">Invisible Mode (No Hint)</button>
            </div>

            <div class="typing-area-container" id="typing-area">
                <pre id="code-hint"></pre>
                <textarea id="user-code-input"></textarea>
            </div>
            
            <button class="primary-btn" id="submit-btn" style="display: none;" onclick="checkCode()">Check My Code</button>

            <div id="results-area"></div>
            <div id="diff-container">
                <div class="diff-box">
                    <h3 class="user-header">Your Code (Line by Line)</h3>
                    <div id="diff-user" class="diff-content"></div>
                </div>
                <div class="diff-box">
                    <h3 class="correct-header">Correct Code (Line by Line)</h3>
                    <div id="diff-correct" class="diff-content"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- 1. The Correct Code for Each Part ---
        const correctCode = {
            part1: `import java.util.Scanner;
import java.util.ArrayList;
import java.util.List;
import java.io.FileWriter;
import java.io.BufferedWriter;
import java.io.IOException;
import java.io.FileReader;
import java.io.BufferedReader;
import java.io.FileNotFoundException;

abstract class Player {
    private String name;
    private char mark;
    
    public Player(String name, char mark) {
        this.name = name;
        this.mark = mark;
    }
    
    public String getName() {
        return this.name;
    }
    
    public char getMark() {
        return this.mark;
    }
    
    public abstract int[] getMove(Board board, Scanner scanner);
}

class HumanPlayer extends Player {
    public HumanPlayer(String name, char mark) {
        super(name, mark);
    }
    
    @Override
    public int[] getMove(Board board, Scanner scanner) {
        int row, col;
        while (true) {
            System.out.print(getName() + "'s turn (Row 0-2): ");
            row = scanner.nextInt();
            System.out.print(getName() + "'s turn (Col 0-2): ");
            col = scanner.nextInt();
            
            if (board.isValidMove(row, col)) {
                return new int[]{row, col};
            } else {
                System.out.println("Invalid move. That spot is taken or out of bounds. Try again.");
            }
        }
    }
}`,
            part2: `class Board {
    private char[][] board;
    
    public Board() {
        board = new char[3][3];
        initializeBoard();
    }
    
    public void initializeBoard() {
        for (int i = 0; i < 3; i++) {
            for (int j = 0; j < 3; j++) {
                board[i][j] = ' ';
            }
        }
    }
    
    public void printBoard() {
        System.out.println("-------------");
        for (int i = 0; i < 3; i++) {
            System.out.print("| ");
            for (int j = 0; j < 3; j++) {
                System.out.print(board[i][j] + " | ");
            }
            System.out.println();
            System.out.println("-------------");
        }
    }
    
    public boolean isValidMove(int row, int col) {
        if (row < 0 || row >= 3 || col < 0 || col >= 3) {
            return false;
        }
        if (board[row][col] != ' ') {
            return false;
        }
        return true;
    }
    
    public boolean placeMark(int row, int col, char mark) {
        if (isValidMove(row, col)) {
            board[row][col] = mark;
            return true;
        }
        return false;
    }
    
    public boolean isBoardFull() {
        for (int i = 0; i < 3; i++) {
            for (int j = 0; j < 3; j++) {
                if (board[i][j] == ' ') {
                    return false;
                }
            }
        }
        return true;
    }
    
    public boolean checkForWin(char mark) {
        // Check rows
        for (int i = 0; i < 3; i++) {
            if (board[i][0] == mark && board[i][1] == mark && board[i][2] == mark) {
                return true;
            }
        }
        // Check columns
        for (int j = 0; j < 3; j++) {
            if (board[0][j] == mark && board[1][j] == mark && board[2][j] == mark) {
                return true;
            }
        }
        // Check diagonals
        if (board[0][0] == mark && board[1][1] == mark && board[2][2] == mark) {
            return true;
        }
        if (board[0][2] == mark && board[1][1] == mark && board[2][0] == mark) {
            return true;
        }
        return false;
    }
}`,
            part3: `class GameLogger {
    private static final String FILENAME = "game_results.txt";
    private static int gameCount = 1;
    
    public static void initializeGameCount() {
        try (FileReader fr = new FileReader(FILENAME);
             BufferedReader br = new BufferedReader(fr)) {
            
            while (br.readLine() != null) {
                gameCount++;
            }
        } catch (FileNotFoundException e) {
            System.out.println("Starting a new game log...");
        } catch (IOException e) {
            System.err.println("Error reading log file: " + e.getMessage());
        }
    }
    
    public static void logResult(String result) {
        try (FileWriter fw = new FileWriter(FILENAME, true);
             BufferedWriter bw = new BufferedWriter(fw)) {
            
            String logEntry = "Game " + gameCount + ": " + result;
            bw.write(logEntry);
            bw.newLine();
            gameCount++;
        } catch (IOException e) {
            System.err.println("Error writing to log file: " + e.getMessage());
        }
    }
}`,
            part4: `public class SimpleTicTacToe {
    private Board board;
    private List<Player> players;
    private int currentPlayerIndex;
    private Scanner scanner;
    
    public SimpleTicTacToe() {
        this.board = new Board();
        this.scanner = new Scanner(System.in);
        this.players = new ArrayList<>();
        this.currentPlayerIndex = 0;
    }
    
    private String getValidPlayerName(String prompt, Scanner scanner) {
        String name;
        while (true) {
            System.out.print(prompt);
            name = scanner.nextLine();
            if (name.trim().isEmpty()) {
                System.out.println("Name cannot be empty. Please try again.");
            } else {
                return name;
            }
        }
    }
    
    public void setupPlayers() {
        System.out.println("Welcome to Tic-Tac-Toe! Let's get your names.");
        String player1Name = getValidPlayerName("Enter name for Player 1 (X): ", scanner);
        players.add(new HumanPlayer(player1Name, 'X'));
        String player2Name = getValidPlayerName("Enter name for Player 2 (O): ", scanner);
        players.add(new HumanPlayer(player2Name, 'O'));
        System.out.println("Let's play! " + player1Name + " vs. " + player2Name);
    }
    
    public void startGame() {
        setupPlayers();
        
        while (true) {
            board.printBoard();
            Player currentPlayer = players.get(currentPlayerIndex);
            
            try {
                int[] move = currentPlayer.getMove(board, scanner);
                board.placeMark(move[0], move[1], currentPlayer.getMark());
            } catch (Exception e) {
                System.out.println("Invalid input. Please enter numbers only.");
                scanner.next(); // Clear the bad input
                continue;
            }
            
            if (board.checkForWin(currentPlayer.getMark())) {
                board.printBoard();
                String result = "Player " + currentPlayer.getName() + " wins!";
                System.out.println(result);
                GameLogger.logResult(result);
                break;
            } else if (board.isBoardFull()) {
                board.printBoard();
                String result = "It's a draw!";
                System.out.println(result);
                GameLogger.logResult(result);
                break;
            } else {
                currentPlayerIndex = (currentPlayerIndex + 1) % 2;
            }
        }
        scanner.close();
    }
    
    public static void main(String[] args) {
        GameLogger.initializeGameCount();
        SimpleTicTacToe game = new SimpleTicTacToe();
        game.startGame();
    }
}`
        };

        // --- 2. State Management ---
        let currentPart = null;
        const partTitles = ["", "Part 1: Imports & Player Classes", "Part 2: The Board Class", "Part 3: The File Logger Class", "Part 4: The Main Game Class"];

        const partSelectionDiv = document.getElementById('part-selection');
        const workspaceDiv = document.getElementById('workspace');
        const workspaceTitle = document.getElementById('workspace-title');
        const typingArea = document.getElementById('typing-area');
        const codeHint = document.getElementById('code-hint');
        const userInput = document.getElementById('user-code-input');
        const submitBtn = document.getElementById('submit-btn');
        const resultsArea = document.getElementById('results-area');
        const diffContainer = document.getElementById('diff-container');
        const diffUser = document.getElementById('diff-user');
        const diffCorrect = document.getElementById('diff-correct');

        // --- 3. Core Functions ---
        function showWorkspace(partNumber) {
            currentPart = 'part' + partNumber;
            workspaceTitle.textContent = partTitles[partNumber];
            partSelectionDiv.style.display = 'none';
            workspaceDiv.style.display = 'block';
            typingArea.style.display = 'none';
            submitBtn.style.display = 'none';
            resultsArea.style.display = 'none';
            diffContainer.style.display = 'none';
        }

        function showMenu() {
            partSelectionDiv.style.display = 'flex';
            workspaceDiv.style.display = 'none';
            currentPart = null;
        }

        function setMode(mode) {
            const code = correctCode[currentPart];
            codeHint.textContent = code;
            userInput.value = '';
            
            if (mode === 'try') {
                codeHint.style.opacity = '0.4';
            } else {
                codeHint.style.opacity = '0';
            }
            
            resultsArea.style.display = 'none';
            diffContainer.style.display = 'none';
            typingArea.style.display = 'block';
            submitBtn.style.display = 'block';
            
            userInput.scrollTop = 0;
            userInput.focus();
        }

        function smartNormalize(str) {
            return str.split('\n')
                .map(s => s.trim())
                .filter(Boolean)
                .join('\n');
        }
        
        function escapeHTML(str) {
            return str.replace(/[&<>"']/g, function(m) {
                return {
                    '&': '&amp;',
                    '<': '&lt;',
                    '>': '&gt;',
                    '"': '&quot;',
                    "'": '&#039;'
                }[m];
            });
        }

        function checkCode() {
            const userCode = userInput.value;
            const answerCode = correctCode[currentPart];
            
            const normalizedUser = smartNormalize(userCode);
            const normalizedAnswer = smartNormalize(answerCode);
            
            if (normalizedUser === normalizedAnswer) {
                resultsArea.textContent = 'üéâ Correct! Well done! üéâ';
                resultsArea.className = 'success';
                resultsArea.style.display = 'block';
                diffContainer.style.display = 'none';
            } else {
                resultsArea.textContent = 'Almost! Some errors were found. See comparison below:';
                resultsArea.className = 'error';
                resultsArea.style.display = 'block';
                
                generateDiffView(userCode, answerCode);
                diffContainer.style.display = 'flex';
            }
        }
        
        /**
         * Generates the HTML for the side-by-side diff view.
         */
        function generateDiffView(userCode, answerCode) {
            const userLines = userCode.split('\n');
            const answerLines = answerCode.split('\n');
            
            const maxLines = Math.max(userLines.length, answerLines.length);
            
            let userHtml = '';
            let answerHtml = '';
            
            for (let i = 0; i < maxLines; i++) {
                const uLine = userLines[i] || '';
                const aLine = answerLines[i] || '';
                
                const isMatch = (uLine.trim() === aLine.trim());
                
                // --- NEW LOGIC ---
                // Only the user's line gets the "error" class
                const userLineClass = isMatch ? 'diff-correct' : 'diff-error';
                const answerLineClass = 'diff-correct'; // Answer is always correct
                
                const uLineDisplay = uLine === '' ? '&nbsp;' : escapeHTML(uLine);
                const aLineDisplay = aLine === '' ? '&nbsp;' : escapeHTML(aLine);
                
                userHtml += `<span class="${userLineClass}">${uLineDisplay}</span>`;
                answerHtml += `<span class="${answerLineClass}">${aLineDisplay}</span>`;
            }
            
            diffUser.innerHTML = userHtml;
            diffCorrect.innerHTML = answerHtml;
        }
        
        // --- 4. Event Listeners ---
        
        // **SCROLLBAR SYNC**
        userInput.addEventListener('scroll', () => {
            codeHint.scrollTop = userInput.scrollTop;
            codeHint.scrollLeft = userInput.scrollLeft;
        });
        
        codeHint.addEventListener('scroll', () => {
            userInput.scrollTop = codeHint.scrollTop;
            userInput.scrollLeft = codeHint.scrollLeft;
        });

    </script>
</body>
</html>
